## 1. **Основные компоненты системы**
- **Sinatra-приложение**: Основной веб-сервис, который обрабатывает HTTP-запросы и управляет логикой взаимодействия с пользователем.
- **Anton.rb**: Внешний скрипт, который выполняет вычисления на основе входных данных (имя человека) и сохраняет результаты в файл `output.json`.
- **Файл `formulas.json`**: Хранилище формул, которые используются для вычисления родственников.
- **Файл `output.json`**: Временный файл, в который сохраняются результаты работы скрипта `Anton.rb`.

---

## 2. **Взаимодействие компонентов**

### **2.1. Поиск родственников**
1. **Пользователь** отправляет POST-запрос на `/search` с параметром `name` (имя человека).
2. **Sinatra-приложение**:
   - Запускает внешний скрипт `Anton.rb` с переданным именем: `system("ruby Anton.rb #{name}")`.
   - Ожидает, что скрипт создаст файл `output.json` с результатами.
3. **Anton.rb**:
   - Выполняет вычисления на основе данных из `people.json` и формул из `formulas.json`.
   - Сохраняет результаты в файл `output.json`.
4. **Sinatra-приложение**:
   - Читает файл `output.json` и передает данные в шаблон `results.erb` для отображения.
   - Если файл `output.json` отсутствует, выводит сообщение об ошибке через шаблон `error.erb`.

### **2.2. Управление формулами**
1. **Просмотр формул**:
   - Пользователь отправляет GET-запрос на `/formulas`.
   - Приложение загружает формулы из `formulas.json` и отображает их через шаблон `formulas.erb`.

2. **Добавление формулы**:
   - Пользователь отправляет GET-запрос на `/formulas/add` для отображения формы добавления.
   - После заполнения формы и отправки POST-запроса на `/formulas/add`:
     - Приложение добавляет новую формулу в `formulas.json`.
     - Перенаправляет пользователя на страницу `/formulas`.

3. **Редактирование формулы**:
   - Пользователь отправляет GET-запрос на `/formulas/edit/:type` для отображения формы редактирования.
   - После заполнения формы и отправки POST-запроса на `/formulas/edit/:type`:
     - Приложение обновляет формулу в `formulas.json`.
     - Перенаправляет пользователя на страницу `/formulas`.

4. **Удаление формулы**:
   - Пользователь отправляет POST-запрос на `/formulas/delete/:type`.
   - Приложение удаляет формулу из `formulas.json`.
   - Перенаправляет пользователя на страницу `/formulas`.

5. **Просмотр формулы**:
   - Пользователь отправляет GET-запрос на `/formulas/view/:type`.
   - Приложение загружает конкретную формулу из `formulas.json` и отображает её через шаблон `view_formula.erb`.

---

## 3. **Потоки данных**

### **3.1. Поиск родственников**
1. Пользователь → Sinatra (POST `/search`) → Anton.rb → `output.json` → Sinatra → Пользователь.

### **3.2. Управление формулами**
1. Пользователь → Sinatra (GET `/formulas`) → `formulas.json` → Sinatra → Пользователь.
2. Пользователь → Sinatra (POST `/formulas/add`) → `formulas.json` → Sinatra → Пользователь.
3. Пользователь → Sinatra (POST `/formulas/edit/:type`) → `formulas.json` → Sinatra → Пользователь.
4. Пользователь → Sinatra (POST `/formulas/delete/:type`) → `formulas.json` → Sinatra → Пользователь.
5. Пользователь → Sinatra (GET `/formulas/view/:type`) → `formulas.json` → Sinatra → Пользователь.

---

## 4. **Зависимости**
- **Sinatra**: Веб-фреймворк для обработки HTTP-запросов.
- **JSON**: Для чтения и записи данных в формате JSON.
- **Файловая система**: Для хранения данных (`formulas.json`, `output.json`, `people.json`).
- **Внешний скрипт (`Anton.rb`)**: Для выполнения вычислений.

---

## 5. **Потенциальные проблемы**
1. **Отсутствие файлов**:
   - Если файл `formulas.json` или `people.json` отсутствует, приложение выдаст ошибку.
   - Решение: Добавить проверку наличия файлов и обработку ошибок.

2. **Ошибки в скрипте `Anton.rb`**:
   - Если скрипт завершается с ошибкой, файл `output.json` не будет создан.
   - Решение: Добавить логирование ошибок и уведомление пользователя.

3. **Конкуренция за файл `output.json`**:
   - Если несколько пользователей одновременно отправляют запросы, файл `output.json` может быть перезаписан.
   - Решение: Использовать уникальные имена файлов для каждого запроса.

4. **Валидация формул**:
   - Если пользователь добавляет невалидную формулу, это может привести к ошибкам в работе скрипта `Anton.rb`.
   - Решение: Добавить валидацию формул перед сохранением.



## 6. **Диаграмма взаимодействия**

Пользователь
    |
    v
Sinatra-приложение
    |
    v
Anton.rb (внешний скрипт)
    |
    v
Файловая система (formulas.json, output.json, people.json)
    |
    v
Sinatra-приложение
    |
    v
Пользователь


---
